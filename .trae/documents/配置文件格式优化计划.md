# 配置文件格式优化计划

## 现状分析

### 当前配置结构问题

```yaml
embedding:
  model: text-embedding-3-small
  dim: 1536
  api_key: ""
  base_url: ""

global:
  chunk_size: 800
  embedding_model: text-embedding-3-small  # 与 embedding.model 重复
  tokenizer: jieba
```

**问题：**
1. `embedding.model` 和 `global.embedding_model` 重复且容易不一致
2. 配置分散，语义不清晰
3. `global` 节命名过于宽泛

## 优化方案

### 新配置结构

```yaml
embedding:
  model: text-embedding-3-small
  dim: 1536
  api_key: ""
  base_url: ""

chunk_size: 800
tokenizer: jieba
log_level: INFO

ontology:
  # ...
```

**改进：**
1. 移除 `global` 节，将 `chunk_size` 和 `tokenizer` 提升到顶层
2. 删除重复的 `embedding_model`，统一使用 `embedding.model`
3. 配置更扁平、更清晰

## 实施步骤

### 步骤 1：修改 KBConfig
- 文件：`src/duckkb/config.py`
- 添加 `chunk_size` 和 `tokenizer` 字段
- 更新 `from_yaml` 从顶层读取这些字段

### 步骤 2：修改 core/config/models.py 的 GlobalConfig
- 移除 `embedding_model` 字段
- 保留 `chunk_size` 和 `tokenizer`

### 步骤 3：修改 core/mixins/config.py
- 更新 `_load_config` 从 `KBConfig` 获取 `chunk_size` 和 `tokenizer`
- 移除从 `global` 节读取 `embedding_model` 的逻辑

### 步骤 4：修改 EmbeddingMixin
- 文件：`src/duckkb/core/mixins/embedding.py`
- 从 `kb_config.embedding.model` 获取模型名称

### 步骤 5：更新测试
- 文件：`tests/test_config.py`
- 更新相关测试

### 步骤 6：更新示例配置文件
- 文件：`.duckkb/default/config.yaml`
- 应用新格式

## 变更文件清单

| 文件 | 操作 |
|------|------|
| `src/duckkb/config.py` | 修改 |
| `src/duckkb/core/config/models.py` | 修改 |
| `src/duckkb/core/mixins/config.py` | 修改 |
| `src/duckkb/core/mixins/embedding.py` | 修改 |
| `tests/test_config.py` | 修改 |
| `.duckkb/default/config.yaml` | 修改 |
