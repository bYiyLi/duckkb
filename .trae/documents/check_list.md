# DuckKB 并发安全改造检查清单

## 设计审查

- [ ] 临时文件路径策略是否合理？
- [ ] 公平读写锁实现是否正确？
- [ ] 接口设计是否完整？

## 代码审查

### 公平读写锁
- [ ] 读锁获取逻辑正确
- [ ] 写锁获取逻辑正确
- [ ] 写饥饿避免机制有效
- [ ] 线程安全保证

### DBMixin
- [ ] 临时文件创建正确
- [ ] 临时文件清理完整
- [ ] 读操作可并发
- [ ] 写操作独占
- [ ] 事务支持正确
- [ ] `conn` 属性已移除

### 调用方修改
- [ ] SearchMixin 正确使用 execute_read
- [ ] StorageMixin 正确使用 write_transaction
- [ ] IndexMixin 正确使用 execute_read/write
- [ ] OntologyMixin 正确使用对应方法

## 测试验证

### 单元测试
- [ ] FairReadWriteLock 测试通过
- [ ] 临时文件创建测试通过
- [ ] 临时文件清理测试通过

### 并发测试
- [ ] 多读并发测试通过
- [ ] 写操作独占测试通过
- [ ] 写不饥饿测试通过
- [ ] 并发读写测试通过

### 回归测试
- [ ] 现有测试套件全部通过
- [ ] 无破坏性变更

## 文档审查

- [ ] README 更新完整
- [ ] 迁移指南清晰
- [ ] 废弃警告文档化

## 部署检查

- [ ] 依赖无新增（或已添加到 pyproject.toml）
- [ ] 配置默认值合理
