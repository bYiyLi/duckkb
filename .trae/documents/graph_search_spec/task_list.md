# 知识图谱检索功能任务列表

## 阶段一：基础模型与索引

| 任务ID | 任务描述                                     | 优先级 | 依赖   |
| ---- | ---------------------------------------- | --- | ---- |
| T1.1 | 在 `ontology.py` 中添加 `EdgeIndexConfig` 模型 | P0  | -    |
| T1.2 | 修改 `EdgeType` 模型，添加 `index` 字段           | P0  | T1.1 |
| T1.3 | 修改 `_generate_edge_ddl` 方法，生成边表索引        | P0  | T1.2 |
| T1.4 | 编写模型单元测试                                 | P1  | T1.3 |

## 阶段二：GraphMixin 核心实现

| 任务ID | 任务描述                                 | 优先级 | 依赖         |
| ---- | ------------------------------------ | --- | ---------- |
| T2.1 | 创建 `graph.py` 文件，定义 `GraphMixin` 类框架 | P0  | -          |
| T2.2 | 实现 `_resolve_node_id` 辅助方法           | P0  | T2.1       |
| T2.3 | 实现 `_get_edges_for_node` 辅助方法        | P0  | T2.1       |
| T2.4 | 实现 `_build_neighbor_query` SQL 构建方法  | P0  | T2.1       |
| T2.5 | 实现 `get_neighbors` 邻居查询方法            | P0  | T2.2-T2.4  |
| T2.6 | 实现 `traverse` 多跳遍历方法                 | P1  | T2.5       |
| T2.7 | 实现 `find_paths` 路径查询方法               | P2  | T2.5       |
| T2.8 | 实现 `extract_subgraph` 子图提取方法         | P1  | T2.5, T2.6 |
| T2.9 | 实现 `graph_search` 融合检索方法             | P0  | T2.5       |

## 阶段三：Engine 集成

| 任务ID | 任务描述                              | 优先级 | 依赖         |
| ---- | --------------------------------- | --- | ---------- |
| T3.1 | 修改 `engine.py`，添加 `GraphMixin` 继承 | P0  | T2.5, T2.9 |
| T3.2 | 验证 Engine 初始化流程                   | P0  | T3.1       |
| T3.3 | 编写 Engine 集成测试                    | P1  | T3.2       |

## 阶段四：MCP 工具暴露

| 任务ID | 任务描述                                                  | 优先级 | 依赖        |
| ---- | ----------------------------------------------------- | --- | --------- |
| T4.1 | 在 `duck_mcp.py` 中注册 `_register_get_neighbors_tool`    | P0  | T3.1      |
| T4.2 | 在 `duck_mcp.py` 中注册 `_register_traverse_tool`         | P1  | T4.1      |
| T4.3 | 在 `duck_mcp.py` 中注册 `_register_find_paths_tool`       | P2  | T4.1      |
| T4.4 | 在 `duck_mcp.py` 中注册 `_register_extract_subgraph_tool` | P1  | T4.1      |
| T4.5 | 在 `duck_mcp.py` 中注册 `_register_graph_search_tool`     | P0  | T4.1      |
| T4.6 | 更新 MCP 工具文档                                           | P1  | T4.1-T4.5 |

## 阶段五：异常处理与测试

| 任务ID | 任务描述                         | 优先级 | 依赖   |
| ---- | ---------------------------- | --- | ---- |
| T5.1 | 在 `exceptions.py` 中添加图谱相关异常类 | P0  | -    |
| T5.2 | 编写 `get_neighbors` 单元测试      | P0  | T2.5 |
| T5.3 | 编写 `traverse` 单元测试           | P1  | T2.6 |
| T5.4 | 编写 `find_paths` 单元测试         | P2  | T2.7 |
| T5.5 | 编写 `extract_subgraph` 单元测试   | P1  | T2.8 |
| T5.6 | 编写 `graph_search` 单元测试       | P0  | T2.9 |
| T5.7 | 编写集成测试                       | P1  | T3.3 |

## 阶段六：文档更新

| 任务ID | 任务描述       | 优先级 | 依赖   |
| ---- | ---------- | --- | ---- |
| T6.1 | 添加图谱检索使用示例 | P1  | T6.1 |

***

## 实现顺序建议

**第一批（核心功能）**：

1. T1.1 -> T1.2 -> T1.3 -> T2.1 -> T2.2 -> T2.3 -> T2.4 -> T2.5 -> T2.9 -> T3.1 -> T4.1 -> T4.5 -> T5.1 -> T5.2 -> T5.6

**第二批（扩展功能）**：
2\. T2.6 -> T2.8 -> T4.2 -> T4.4 -> T5.3 -> T5.5

**第三批（高级功能）**：
3\. T2.7 -> T4.3 -> T5.4

**第四批（完善）**：
4\. T1.4 -> T3.3 -> T4.6 -> T5.7 -> T6.1
