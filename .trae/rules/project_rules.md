---
alwaysApply: true
---
# DuckKB 项目规范

## 开发风格

* Python >= 3.12；依赖用 uv 管理；新增依赖必须写清用途与替代方案
* 遵循 PEP 8；保持格式一致（同类代码写法一致优先）
* 修改前先定位入口与数据流：先读代码/文档再动手，禁止凭空猜实现
* 小步改动：一次只做一类改动，避免顺手重构半个项目
* 禁止过度设计：优先最简单可维护方案，复用现有模式与工具
* 公共 API 与跨模块边界必须完整类型标注（参数/返回值）
* 禁止同步代码：核心逻辑必须 async/await；阻塞 I/O 只能通过 asyncio.to_thread 封装
* 代码中禁止散落副作用：I/O、网络、DB 访问必须集中在明确的边界模块
* 日志只用 logging；禁止 print；禁止记录密钥/token/隐私与长文本原文
* 文件写入必须原子化（先写临时文件再重命名）
* 必须使用ruff进行代码格式化

## 变更流程

* 变更前先解释“要改什么/为什么改/怎么验证”，复杂变更先写方案再落地

## Git 规则

* 不提交运行产物（例如 `.build/**`、任何 `.db`）
* 提交信息用 Conventional Commits：feat/fix/refactor/docs/test/chore
